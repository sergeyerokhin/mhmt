30.01.2010

Начинаю добавлять хрум.
Проблема при добавлении хрума: в мегалзе было начало - сначала байт на выход, потом битовый байт. Делалось без проблем.
Теперь: сначал битовое слово, потом байт на выход, потом только остальной поток. Разрыв как бы.
Решение - сначала загнать байт тот в EMIT_BYTE_ADD, потом он высрется как обычно с первым EMIT_BITS_FLUSH самым
первым после начальных битов.

Фикс - было подкручивание actual_len в mhmt-pack.c. Теперь разбираться с этим должны конечные функции.

Депакер мегалза начальное значение битстрима берет всегда как 8 бит - правильно ли? Это не проблема -
даётся параметр _FORCE и заданное в функцию кол-во бит игнорируется.

В depack_outbyte нет проверки на то, что disp выходит за пределы начала уже распакованного файла.


06.02.2010

Начато добавление хруста.

Не все функции могли осилить code.length<0 - fixed.

Мысли по оптимальному кодированию для хруста:
сейчас сделал - длина расширяемой ссылки зависит только от позиции от начала файла, где эта ссылка встретилась.
Варианты:
1. длина ссылки зависит только от её собственного смещения и только на основе этого строится оптимальная цепочка.
   На этапе кодирования же длина будет какая получится - с учётом расширения и т.д.
2. В цепочке оптимального кодирования хранить наследуемый атрибут - о расширенности ссылки. На основе этого патчить длину
   расширяемой ссылки при составлении цепочки. При этом, однако, некоторые пути с нерасширенными ссылками могут затираться новыми
   путями с расширенными, хотя путь с нерасширенными ссылками мог бы потом оказаться оптимальнее. Другими словами, надо помнить
   КАЖДЫЙ путь для истинно оптимального кодирования с изменяющимися в процессе битовыми длинами ссылок.
Нужна экспериментальная проверка.

Надо-таки разобраться с actual_len. Предложение - развоить её в pack_len, которая будет, если надо, на 5 или 6 байт короче,
а actual_len всегда отражает длину входного файла.


13.02.10

Нашёлся мега-глюк в хруме - неправильный формат (алко виноват!!!). Фиксед.

В заголовке хруста - неверно ставится распакованная длина, а запакованная - ставится по модулю 65536.


14.02.10


